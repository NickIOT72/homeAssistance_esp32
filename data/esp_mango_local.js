//This code was autogenerated by ESP Mango code generator V1.2 for "sketch_espmango" sketch at: 25-08-2024 22:20:24
//ESP Mango code generator was created by Julian D. Medina --- JulianDM1995@gmail.com - 2020 

//--------------------------------------------------| DONT FORGET TO ADD IN HTML |--------------------------------------------------
/*
<script src="esp_mango_local.js"></script>
<script src="b2f_local.js"></script>
<script src="f2b_local.js"></script>
<script src="conn_evt.js"></script>
*/
//-----------------------------------------------------| ESP Mango VARIABLES |------------------------------------------------------

var reconnectionPeriod = 1000;

//-------------------------------------------------------| DEBUG VARIABLES |--------------------------------------------------------

var ServeDebug = true;
var BackendToFrontendDebug = true;
var FrontendToBackendDebug = true;
var LoadFunctionsDebug = true;

//==================================================================================================================================
//------------------------------------------| MAIN ESP-MANGO FOR JAVASCRIPT/LOCAL-SERVER |------------------------------------------
//==================================================================================================================================


//---------------------------------------------------| WEBSOCKET CONFIGURATION |----------------------------------------------------

var websocket;
//window.addEventListener("load", webSocketEvent, false);

function webSocketEvent(cb) {
    websocket = new WebSocket('ws://' + location.hostname + ':81/');
    websocket.onopen = function(evt) {
        onServerConnection(cb);
    };
    websocket.onclose = function(evt) {
        setTimeout(function() {
            webSocketEvent()
        }, reconnectionPeriod);
        onServerDisconnection();
    };
    websocket.onmessage = function(evt) {
        console.log("Received:" + evt.data);

        //Load values from this json object
        var jsonObj = JSON.parse(evt.data);

        executeFunction(jsonObj);
    };
    websocket.onerror = function(evt) {
        console.log("Websocket error :" + evt.data);
    };
}

//---------------------------------------------------------| JSON REQUEST |---------------------------------------------------------

function ArduinoJSONRequest(url, requestFunction) {
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            requestFunction(this.responseText);
        }
    };

    xhr.onerror = function() {
        console.log("Error in the request of \"" + url + "\"");
    };

    xhr.open("GET", url, true);
    xhr.send();
};